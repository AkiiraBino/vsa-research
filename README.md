# Ресерч по ML видеоаналитике

Собран код, написанный во время работы над исследованием по видеоаналитике, ML часть.

## Edge node

### Описание
Модуль предназначен для вещания видеопотоков с камер в реальном времени. Поддерживает настройку количества камер, отображение видео, фильтрацию ключевых кадров и изменение размера изображения.

### Установка
Для использования программы необходимо установить необходимые зависимости. Вы можете сделать это, выполнив следующую команду:

`pip install -r requirements.txt`

### Использование
Программа предоставляет несколько параметров командной строки для настройки:

`--num_cam`: Количество камер для вещания (по умолчанию: 2)

`--enable_display`: Включить/отключить отображение видео из потоков (по умолчанию: False)

`--enable_filter_keyframes`: Включить/отключить фильтрацию ключевых кадров с использованием абсолютной разницы (по умолчанию: True)

`--imgsz`: Размер изображения для отображения (по умолчанию: 640)

`--enable_zmq`: Включить/отключить передачу фреймов по zmq (по умолчанию: False)

Пример запуска программы:


`python video_streamer.py --num_cam 4 --enable_display True --imgsz 800`

### Конфигурация
Для указания адресов камер необходимо создать файл с переменными окружения: `.env`. Пример находится в `.env.example`

## Model builder

### Описание
Модуль для тренировки моделей, аугментации датасета, тестов с инференсом модели.

### Установка
Для использования программы необходимо установить необходимые зависимости. Вы можете сделать это, выполнив следующую команду:

`pip install -r requirements.txt`

Также требуется заранее скачать модель, либо при инициализации `Yolov8Detector` указать название модели (например `yolov8n.pt`), в таком случае модель скачается автоматически.
Еще одним требованием является датасет в формате coco, либо просто папка с изображениями для выполнения `predict`

### Использование
В теле main.py прописываем, что надо сделать, в примере predict


## ipynb

### Описание

Блокноты с наработками

* `ananlysis` - анализ изначальных данных
* `benchmark` - ноутбук с наработками для edge-server. Принимает по zmq фреймы,тестирует задержку, в будущем будет перенесено в отдельный модуль
* `keyframes_test` - ноутбук с тестами для подбора оптимальной константы с выбором кейфреймов
* `marking` - разметка изначальных данных (видео) необученной моделью, **устарел**
* `marking_img` - разметка изначальных данных (изображения) необученной моделью, **устарел**
* `memory_test` - тесты со сжатием изображений классическими методами (resize + webp), добавлением метаданных и созданием pickle (так как в zmq передача pickle объектов)
* `pca_test` - тесты с pca сжатием, как альтернативой
* `utils` - получение метаданных для analysis